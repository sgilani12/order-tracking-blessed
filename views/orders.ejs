<!DOCTYPE html>

<html lang="en">
    <%- include('partials/head') %>
    <body>
        <%- include('partials/topbar') %>
        <%- include('partials/side-nav') %>
        <div class="page-content">
        <h1>This is the orders page</h1>
        

        <!--bulma modal as popup form to edit order-->
        <div class="modal">
            <div class="modal-background"></div>
            <div class="modal-card">
              <header class="modal-card-head">
                <p class="modal-card-title">Edit Order</p>
                <button onClick="hidePopup()" id="delete" class="delete" aria-label="close"></button>
              </header>
              <section class="modal-card-body">
                <!-- Content ... -->
                    <form name="editOrder" enctype="application/x-www-form-urlencoded">
                        <table>
                            <tr>
                                <td>Order ID</td>
                                <td><input readonly type="text" name="order_id" id="order_id" class="input"></td>
                            </tr>
                            <tr>
                                <td>Customer ID</td>
                                <td><input readonly type="text" name="customer_id" id="customer_id" class="input"></td>
                            </tr>
                            <tr>
                                <td>Order Status Code</td>
                                <td>
                                <div  class="select">
                                    <select id="status_field">
                                        <option id="Draft">Draft</option>
                                        <option id="Open">Open</option>
                                        <option id="Finalized">Finalized</option>
                                        <option id="Preparing to ship">Preparing to ship</option>
                                        <option id="Ready for shipping">Ready for shipping</option>
                                        <option id="Shipped">Shipped</option>
                                        <option id="Delivered">Delivered</option>
                                        <option id="Closed">Closed</option>
                                    </select>
                                </div>
                            </td>
                            </tr>
                            <tr>
                                <td>Date/Time Order Placed</td>
                                <td><input readonly type="text" name="datetime" id="datetime" class="input"></td>
                            </tr>
                            <tr>
                                <td>Total Order Price</td>
                                <td><input readonly type="text" name="price" id="price" class="input"></td>
                            </tr>
                            <tr>
                                <td>Order Notes</td>
                                <td><textarea type="text" name="order_notes" id="order_notes" class="textarea"></textarea></td>
                            </tr>
                        </table>
                    </form>
              </section>
              <footer class="modal-card-foot">
                <button onclick="hidePopup()" class="button">Cancel</button>
                <button  id="submitButton" class="button is-success">Save changes</button>
              </footer>
            </div>
          </div>


        <table class="table">
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Customer ID</th>
                    <th>Order Status Code</th>
                    <th>Date/Time Orders Placed</th>
                    <th>Total Order Price</th>
                    <th>Order Notes</th>
                </tr>
            </thead>
            <tbody>
                <!--object called orders loaded on page render -->
                <% if(orders.length > 0){ %>

                    <% for ( var i = 0 ; i < orders.length ; i++){ %>
                        
                    <tr>
                       <td>
                           <a onClick="showPopup('<%- orders[i].order_id%>', '<%- orders[i].customer_id%>', '<%- orders[i].order_status_code%>', '<%- orders[i].datetime_order_placed%>', '<%- orders[i].total_order_price%>', '<%- orders[i].order_notes%>')"><%= orders[i].order_id%></a>
                          
                       </td>
                       <td>
                          <%= orders[i].customer_id%>
                       </td>
                       <td>
                        <%= orders[i].order_status_code%>
                     </td>
                     <td>
                        <%= orders[i].datetime_order_placed%>
                     </td>
                     <td>
                        <%= orders[i].total_order_price%>
                     </td>
                     <td>
                        <%= orders[i].order_notes%>
                     </td>
                    </tr>
                    <% } %>
          
                 <% } %>
            </tbody>
            <tfoot></tfoot>
        </table>
        </div>

        <script>
            const modal = document.getElementsByClassName("modal")[0];
            const submitButton = document.getElementById("submitButton");
            function showPopup(order_id, customer_id, status, datetime, price, notes){
                submitButton.setAttribute("onclick", `submitForm(${order_id})`)
                //add is-active to .modal to display it
                modal.classList.add("is-active");
                //DOM elements inside modal
                const order_id_field  = document.getElementById('order_id');
                const customer_id_field  = document.getElementById('customer_id');
                const status_field  = document.getElementById('status');
                const datetime_field  = document.getElementById('datetime');
                const price_field  = document.getElementById('price');
                const order_notes_field  = document.getElementById('order_notes');
                //populate form fields based on parameters
                order_id_field.value = order_id;
                customer_id_field.value = customer_id;
                //status needs to auto select an option 
                //status_field.value = status;
                document.getElementById(status).setAttribute("selected", true);
                datetime_field.value = datetime;
                price_field.value = price;
                order_notes_field.value = notes;
            }
            function hidePopup(){
                //remove is-active 
                modal.classList.remove("is-active");
            }
            function submitForm(order_id){
                let confirmation = confirm(`Editing order ${order_id}`);
                if (confirmation){
                    console.log("send put request to api now");
                }else{
                    console.log("cancel edit")
                }
                modal.classList.remove("is-active");
            }
        </script>

    </body>
</html>
